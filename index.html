<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Creative Pipeline - Marna Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Supabase configuration
    const SUPABASE_URL = 'https://drugmxxnwfwvtnjzrlnk.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRydWdteHhud2Z3dnRuanpybG5rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTczNDQsImV4cCI6MjA4NzMzMzM0NH0.eKIHW4fDsadxof05CZRQdq3ugLAzIl0euiiY1OGX2R4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const STATUS_COLUMNS = ['Drafted', 'In Production', 'Live'];

    function MarnaDashboard() {
      const [scripts, setScripts] = useState([]);
      const [creators, setCreators] = useState([]);
      const [activeTab, setActiveTab] = useState('overview');
      const [expandedScript, setExpandedScript] = useState(null);
      const [draggedScript, setDraggedScript] = useState(null);
      const [showMonthlyView, setShowMonthlyView] = useState(false);
      const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
      const [logo, setLogo] = useState(null);
      const [showMonthlySpend, setShowMonthlySpend] = useState(false);
      const [showMonthlyScripts, setShowMonthlyScripts] = useState(false);
      const [loading, setLoading] = useState(true);
      const [draggedCreator, setDraggedCreator] = useState(null);
      const [creatorOrder, setCreatorOrder] = useState([]);

      // Fetch data from Supabase
      useEffect(() => {
        fetchData();
      }, []);

      const fetchData = async () => {
        setLoading(true);
        console.log('Fetching data from Supabase...');
        const { data: scriptsData, error: scriptsError } = await supabase.from('Scripts').select('*');
        const { data: creatorsData, error: creatorsError } = await supabase.from('Creators').select('*');
        
        console.log('Scripts:', scriptsData, 'Error:', scriptsError);
        console.log('Creators:', creatorsData, 'Error:', creatorsError);
        
        setScripts(scriptsData || []);
        setCreators(creatorsData || []);
        setCreatorOrder((creatorsData || []).map(c => c.id));
        setLoading(false);
      };

      const updateScript = async (id, field, value) => {
        const { error } = await supabase
          .from('Scripts')
          .update({ [field]: value })
          .eq('id', id);
        
        if (!error) {
          setScripts(scripts.map(s => s.id === id ? { ...s, [field]: value } : s));
        }
      };

      const updateCreator = async (id, field, value) => {
        const { error } = await supabase
          .from('Creators')
          .update({ [field]: value })
          .eq('id', id);
        
        if (!error) {
          setCreators(creators.map(c => c.id === id ? { ...c, [field]: value } : c));
        }
      };

      const addScript = async () => {
        const { data, error } = await supabase
          .from('Scripts')
          .insert([{
            name: 'New Script',
            status: 'Drafted',
            lane: 'Problem‚ÜíSolution',
            winning_ads: 0,
            date_created: new Date().toISOString().split('T')[0]
          }])
          .select();
        
        if (!error && data) {
          setScripts([...scripts, data[0]]);
        }
      };

      const deleteScript = async (id) => {
        if (!confirm('Delete this script?')) return;
        
        const { error } = await supabase
          .from('Scripts')
          .delete()
          .eq('id', id);
        
        if (!error) {
          setScripts(scripts.filter(s => s.id !== id));
        }
      };

      const addCreator = async () => {
        const { data, error } = await supabase
          .from('Creators')
          .insert([{
            name: 'New Creator',
            status: 'Shortlisted',
            rate: 100,
            winning_ads: 0,
            scripts_assigned: 0,
            actual_spend: 0,
            rating: 0
          }])
          .select();
        
        if (!error && data) {
          setCreators([...creators, data[0]]);
          setCreatorOrder([...creatorOrder, data[0].id]);
        }
      };

      const deleteCreator = async (id) => {
        if (!confirm('Delete this creator?')) return;
        
        const { error } = await supabase
          .from('Creators')
          .delete()
          .eq('id', id);
        
        if (!error) {
          setCreators(creators.filter(c => c.id !== id));
          setCreatorOrder(creatorOrder.filter(cid => cid !== id));
        }
      };

      const totalCreatorSpend = creators.reduce((sum, c) => sum + (c.actual_spend || 0), 0);
      const liveScripts = scripts.filter(s => s.status === 'Live').length;
      const inProductionScripts = scripts.filter(s => s.status === 'In Production').length;
      const draftedScripts = scripts.filter(s => s.status === 'Drafted').length;
      
      // Calculate winning_ads dynamically from scripts
      const getCreatorWinningAds = (creatorName) => {
        return scripts
          .filter(s => s.creator === creatorName && s.winning_ads === 1)
          .length;
      };
      
      // Add dynamic winning_ads to creators
      const creatorsWithStats = creators.map(c => ({
        ...c,
        winning_ads: getCreatorWinningAds(c.name),
        scripts_assigned: scripts.filter(s => s.creator === c.name).length
      }));

      // Sort creators by custom order
      const sortedCreators = creatorOrder
        .map(id => creatorsWithStats.find(c => c.id === id))
        .filter(Boolean);
      
      const topCreators = [...creatorsWithStats].sort((a, b) => b.winning_ads - a.winning_ads).slice(0, 5);
      const winningHooks = scripts.filter(s => s.winning_ads === 1).sort((a, b) => (b.winning_ads || 0) - (a.winning_ads || 0)).slice(0, 5);

      const getMonthlyLaunches = () => {
        const launches = scripts.filter(s => s.date_launched);
        const byMonth = launches.reduce((acc, script) => {
          const month = script.date_launched.slice(0, 7);
          if (!acc[month]) acc[month] = [];
          acc[month].push(script);
          return acc;
        }, {});
        return byMonth;
      };

      const monthlyLaunches = getMonthlyLaunches();
      const launchesInSelectedMonth = monthlyLaunches[selectedMonth] || [];

      const getMonthlyCreatorSpend = () => {
        const launches = scripts.filter(s => s.date_launched && s.creator);
        const byMonth = launches.reduce((acc, script) => {
          const month = script.date_launched.slice(0, 7);
          const creator = creators.find(c => c.name === script.creator);
          const cost = creator ? creator.rate : 0;
          
          if (!acc[month]) acc[month] = 0;
          acc[month] += cost;
          return acc;
        }, {});
        return byMonth;
      };

      const monthlyCreatorSpend = getMonthlyCreatorSpend();
      const spendInSelectedMonth = monthlyCreatorSpend[selectedMonth] || 0;

      const getMonthlyScriptCount = () => {
        const launched = scripts.filter(s => s.date_launched);
        const byMonth = launched.reduce((acc, script) => {
          const month = script.date_launched.slice(0, 7);
          if (!acc[month]) acc[month] = 0;
          acc[month] += 1;
          return acc;
        }, {});
        return byMonth;
      };

      const monthlyScriptCount = getMonthlyScriptCount();
      const scriptsInSelectedMonth = monthlyScriptCount[selectedMonth] || 0;

      const scriptsByStatus = STATUS_COLUMNS.reduce((acc, status) => {
        acc[status] = scripts.filter(s => s.status === status).length;
        return acc;
      }, {});

      const statusChartData = Object.entries(scriptsByStatus)
        .filter(([_, count]) => count > 0)
        .map(([status, count]) => ({ status, count }));

      const handleDragStart = (script) => {
        setDraggedScript(script);
      };

      const handleDrop = async (newStatus) => {
        if (draggedScript) {
          await updateScript(draggedScript.id, 'status', newStatus);
          setDraggedScript(null);
        }
      };

      const handleDragOver = (e) => {
        e.preventDefault();
      };

      const handleCreatorDragStart = (creator) => {
        setDraggedCreator(creator);
      };

      const handleCreatorDrop = (targetCreator) => {
        if (!draggedCreator || draggedCreator.id === targetCreator.id) return;
        
        const newOrder = [...creatorOrder];
        const draggedIndex = newOrder.indexOf(draggedCreator.id);
        const targetIndex = newOrder.indexOf(targetCreator.id);
        
        newOrder.splice(draggedIndex, 1);
        newOrder.splice(targetIndex, 0, draggedCreator.id);
        
        setCreatorOrder(newOrder);
        setDraggedCreator(null);
      };

      const handleImageUpload = (creatorId, e) => {
        const file = e.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            updateCreator(creatorId, 'image', e.target?.result);
          };
          reader.readAsDataURL(file);
        }
      };

      const handleLogoUpload = (e) => {
        const file = e.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            setLogo(e.target?.result);
          };
          reader.readAsDataURL(file);
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-white flex items-center justify-center">
            <div className="text-2xl font-semibold text-gray-900">Loading Creative Pipeline...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-white">
          <div className="border-b-2 border-[#214e65] bg-white sticky top-0 z-50 shadow-sm">
            <div className="max-w-[1600px] mx-auto px-4 sm:px-8 py-4 sm:py-5">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div className="flex items-center gap-3 sm:gap-4">
                  <div className="relative group">
                    {logo ? (
                      <img src={logo} alt="Logo" className="h-8 sm:h-10 w-auto object-contain cursor-pointer" onClick={() => document.getElementById('logo-upload').click()} />
                    ) : (
                      <div 
                        onClick={() => document.getElementById('logo-upload').click()}
                        className="h-8 w-8 sm:h-10 sm:w-10 border-2 border-dashed border-gray-300 rounded flex items-center justify-center cursor-pointer hover:border-[#214e65] transition"
                      >
                        <span className="text-xs text-gray-400">Logo</span>
                      </div>
                    )}
                    <input
                      id="logo-upload"
                      type="file"
                      accept="image/*"
                      onChange={handleLogoUpload}
                      className="hidden"
                    />
                  </div>
                  <div>
                    <h1 className="text-xl sm:text-2xl font-semibold text-gray-900">Creative Pipeline</h1>
                    <p className="text-xs sm:text-sm text-gray-500">Content & Creator Management</p>
                  </div>
                </div>
                <div className="flex gap-2 sm:gap-3 w-full sm:w-auto overflow-x-auto">
                  <button
                    onClick={() => setActiveTab('overview')}
                    className={`px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg font-medium transition-all text-sm whitespace-nowrap ${
                      activeTab === 'overview'
                        ? 'bg-[#214e65] text-white shadow-md'
                        : 'bg-white text-gray-700 border-2 border-[#214e65] hover:bg-blue-50'
                    }`}
                  >
                    Overview
                  </button>
                  <button
                    onClick={() => setActiveTab('scripts')}
                    className={`px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg font-medium transition-all text-sm whitespace-nowrap ${
                      activeTab === 'scripts'
                        ? 'bg-[#214e65] text-white shadow-md'
                        : 'bg-white text-gray-700 border-2 border-[#214e65] hover:bg-blue-50'
                    }`}
                  >
                    Scripts
                  </button>
                  <button
                    onClick={() => setActiveTab('creators')}
                    className={`px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg font-medium transition-all text-sm whitespace-nowrap ${
                      activeTab === 'creators'
                        ? 'bg-[#214e65] text-white shadow-md'
                        : 'bg-white text-gray-700 border-2 border-[#214e65] hover:bg-blue-50'
                    }`}
                  >
                    Creators
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-[1600px] mx-auto px-4 sm:px-8 py-6 sm:py-8">
            {activeTab === 'overview' && (
              <div className="space-y-8">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0">
                  <h2 className="text-xl sm:text-2xl font-semibold text-gray-900">Performance Overview</h2>
                  <button
                    onClick={() => setShowMonthlyView(!showMonthlyView)}
                    className="px-3 sm:px-4 py-2 bg-[#214e65] text-white rounded-lg font-medium hover:opacity-90 transition text-sm"
                  >
                    {showMonthlyView ? 'Hide' : 'View'} Monthly Launches
                  </button>
                </div>

                {showMonthlyView && (
                  <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                    <div className="flex items-center gap-4 mb-6">
                      <h3 className="text-lg font-semibold text-gray-900">Launches by Month</h3>
                      <input
                        type="month"
                        value={selectedMonth}
                        onChange={(e) => setSelectedMonth(e.target.value)}
                        className="border-2 border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-[#214e65] focus:outline-none"
                      />
                      <span className="text-sm text-gray-500">
                        {launchesInSelectedMonth.length} script{launchesInSelectedMonth.length !== 1 ? 's' : ''} launched
                      </span>
                    </div>

                    <div className="space-y-3">
                      {launchesInSelectedMonth.length > 0 ? (
                        launchesInSelectedMonth.map(script => (
                          <div key={script.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <div className="flex-1">
                              <div className="font-semibold text-gray-900">{script.name}</div>
                              <div className="flex items-center gap-3 mt-1 text-xs text-gray-500">
                                <span>{script.creator || 'Unassigned'}</span>
                                <span>‚Ä¢</span>
                                <span>{script.lane}</span>
                                <span>‚Ä¢</span>
                                <span>Launched: {new Date(script.date_launched).toLocaleDateString()}</span>
                              </div>
                            </div>
                            <div className="text-center ml-4">
                              <div className="text-xl font-bold text-[#214e65]">{script.winning_ads}</div>
                              <div className="text-xs text-gray-500">wins</div>
                            </div>
                          </div>
                        ))
                      ) : (
                        <div className="text-center py-8 text-gray-500">
                          No scripts launched in this month
                        </div>
                      )}
                    </div>
                  </div>
                )}

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                  <div 
                    onClick={() => setShowMonthlyScripts(!showMonthlyScripts)}
                    className="bg-white rounded-2xl p-5 border-2 border-[#214e65] shadow-sm cursor-pointer hover:shadow-lg transition-shadow"
                  >
                    <div className="text-gray-500 text-sm font-medium mb-1">Total Scripts {showMonthlyScripts && '(Click to hide)'}</div>
                    <div className="text-4xl font-semibold text-gray-900">{scripts.length}</div>
                  </div>
                  <div 
                    onClick={() => setShowMonthlySpend(!showMonthlySpend)}
                    className="bg-white rounded-2xl p-5 border-2 border-[#214e65] shadow-sm cursor-pointer hover:shadow-lg transition-shadow"
                  >
                    <div className="text-gray-500 text-sm font-medium mb-1">Total Creator Spend {showMonthlySpend && '(Click to hide)'}</div>
                    <div className="text-4xl font-semibold text-[#214e65]">¬£{totalCreatorSpend.toLocaleString()}</div>
                  </div>
                  <div className="bg-white rounded-2xl p-5 border-2 border-[#214e65] shadow-sm">
                    <div className="text-gray-500 text-sm font-medium mb-1">Script Status</div>
                    <div className="flex items-center gap-4 mt-1">
                      <div>
                        <div className="text-sm text-gray-500">Drafted</div>
                        <div className="text-2xl font-semibold text-gray-600">{draftedScripts}</div>
                      </div>
                      <div className="w-px h-12 bg-gray-200"></div>
                      <div>
                        <div className="text-sm text-gray-500">In Production</div>
                        <div className="text-2xl font-semibold text-orange-600">{inProductionScripts}</div>
                      </div>
                      <div className="w-px h-12 bg-gray-200"></div>
                      <div>
                        <div className="text-sm text-gray-500">Live</div>
                        <div className="text-2xl font-semibold text-green-600">{liveScripts}</div>
                      </div>
                    </div>
                  </div>
                </div>

                {showMonthlySpend && (
                  <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                    <div className="flex items-center gap-4 mb-6">
                      <h3 className="text-lg font-semibold text-gray-900">Creator Spend by Month</h3>
                      <input
                        type="month"
                        value={selectedMonth}
                        onChange={(e) => setSelectedMonth(e.target.value)}
                        className="border-2 border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-[#214e65] focus:outline-none"
                      />
                      <span className="text-sm text-gray-500">
                        ¬£{spendInSelectedMonth.toLocaleString()} spent
                      </span>
                    </div>

                    <div className="space-y-3">
                      {Object.entries(monthlyCreatorSpend)
                        .sort(([a], [b]) => b.localeCompare(a))
                        .map(([month, amount]) => (
                          <div 
                            key={month} 
                            onClick={() => setSelectedMonth(month)}
                            className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer transition ${
                              month === selectedMonth
                                ? 'bg-[#214e65] text-white border-[#214e65]'
                                : 'bg-gray-50 border-gray-200 hover:border-[#214e65]'
                            }`}
                          >
                            <div className="font-medium">
                              {new Date(month + '-01').toLocaleDateString('en-GB', { month: 'long', year: 'numeric' })}
                            </div>
                            <div className="text-xl font-bold">¬£{amount.toLocaleString()}</div>
                          </div>
                        ))}
                    </div>
                  </div>
                )}

                {showMonthlyScripts && (
                  <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                    <div className="flex items-center gap-4 mb-6">
                      <h3 className="text-lg font-semibold text-gray-900">Scripts Launched by Month</h3>
                      <input
                        type="month"
                        value={selectedMonth}
                        onChange={(e) => setSelectedMonth(e.target.value)}
                        className="border-2 border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-[#214e65] focus:outline-none"
                      />
                      <span className="text-sm text-gray-500">
                        {scriptsInSelectedMonth} script{scriptsInSelectedMonth !== 1 ? 's' : ''} launched
                      </span>
                    </div>

                    <div className="space-y-3">
                      {Object.entries(monthlyScriptCount)
                        .sort(([a], [b]) => b.localeCompare(a))
                        .map(([month, count]) => (
                          <div 
                            key={month} 
                            onClick={() => setSelectedMonth(month)}
                            className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer transition ${
                              month === selectedMonth
                                ? 'bg-[#214e65] text-white border-[#214e65]'
                                : 'bg-gray-50 border-gray-200 hover:border-[#214e65]'
                            }`}
                          >
                            <div className="font-medium">
                              {new Date(month + '-01').toLocaleDateString('en-GB', { month: 'long', year: 'numeric' })}
                            </div>
                            <div className="text-xl font-bold">{count} script{count !== 1 ? 's' : ''}</div>
                          </div>
                        ))}
                    </div>
                  </div>
                )}

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                  <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                    <h3 className="text-lg font-semibold text-gray-900 mb-6">Script Status Distribution</h3>
                    <div className="space-y-4">
                      {STATUS_COLUMNS.map(status => (
                        <div key={status} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                          <span className="font-medium text-gray-700">{status}</span>
                          <span className="text-2xl font-bold text-[#214e65]">{scriptsByStatus[status]}</span>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                    <h3 className="text-lg font-semibold text-gray-900 mb-6">Top Creators by Winning Ads</h3>
                    <div className="space-y-3">
                      {topCreators.map((creator, index) => (
                        <div key={creator.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                          <div className="flex items-center gap-4">
                            <div className="text-2xl font-bold text-gray-400 w-8">#{index + 1}</div>
                            <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                              {creator.image ? (
                                <img src={creator.image} alt={creator.name} className="w-10 h-10 rounded-full object-cover" />
                              ) : (
                                <span className="text-[#214e65] font-semibold">{creator.name[0]}</span>
                              )}
                            </div>
                            <div>
                              <div className="font-semibold text-gray-900">{creator.name}</div>
                              <div className="text-xs text-gray-500">{creator.scripts_assigned} scripts assigned</div>
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-2xl font-bold text-[#214e65]">{creator.winning_ads}</div>
                            <div className="text-xs text-gray-500">winning ads</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl p-6 border-2 border-[#214e65] shadow-sm">
                  <h3 className="text-lg font-semibold text-gray-900 mb-6">Winning Hooks Scoreboard</h3>
                  <div className="grid grid-cols-1 gap-4">
                    {winningHooks.map((script, index) => (
                      <div key={script.id} className="flex items-center justify-between p-5 bg-gray-50 rounded-xl border border-gray-200">
                        <div className="flex items-center gap-4 flex-1">
                          <div className="text-2xl font-bold text-gray-400 w-8">#{index + 1}</div>
                          <div className="flex-1">
                            <div className="font-semibold text-gray-900 mb-1">{script.name}</div>
                            <div className="text-sm text-gray-500">{script.creator} ¬∑ {script.lane}</div>
                          </div>
                        </div>
                        <div className="flex items-center gap-6">
                          <div className="text-center">
                            <div className="text-2xl font-bold text-[#214e65]">1</div>
                            <div className="text-xs text-gray-500">win</div>
                          </div>
                          <div>
                            <span className={`px-4 py-2 rounded-full text-sm font-medium ${
                              script.status === 'Live' 
                                ? 'bg-green-100 text-green-700 border-2 border-green-500' 
                                : 'bg-orange-100 text-orange-700 border-2 border-orange-500'
                            }`}>
                              {script.status}
                            </span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'scripts' && (
              <div className="space-y-6">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0">
                  <h2 className="text-xl sm:text-2xl font-semibold text-gray-900">Scripts Pipeline</h2>
                  <button
                    onClick={addScript}
                    className="px-4 sm:px-5 py-2 sm:py-2.5 bg-[#214e65] text-white rounded-lg font-medium hover:opacity-90 transition text-sm w-full sm:w-auto"
                  >
                    + New Script
                  </button>
                </div>

                <div className="overflow-x-auto pb-4 -mx-4 sm:mx-0 px-4 sm:px-0">
                  <div className="flex gap-3 sm:gap-4 min-w-max">
                    {STATUS_COLUMNS.map(status => (
                      <div
                        key={status}
                        className="w-72 sm:w-80 flex-shrink-0"
                        onDrop={() => handleDrop(status)}
                        onDragOver={handleDragOver}
                      >
                        <div className="bg-gray-50 rounded-t-xl p-4 border-2 border-[#214e65] border-b-0">
                          <div className="flex items-center justify-between">
                            <h3 className="font-semibold text-gray-900">{status}</h3>
                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                              {scripts.filter(s => s.status === status).length}
                            </span>
                          </div>
                        </div>
                        <div className="bg-white border-2 border-[#214e65] rounded-b-xl p-4 min-h-[500px] space-y-3">
                          {scripts
                            .filter(s => s.status === status)
                            .map(script => (
                              <div
                                key={script.id}
                                draggable
                                onDragStart={() => handleDragStart(script)}
                                className="bg-white border-2 border-gray-200 rounded-xl p-3 sm:p-4 cursor-move hover:shadow-2xl hover:border-[#214e65] hover:scale-105 transition-all duration-200 relative touch-manipulation"
                              >
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    deleteScript(script.id);
                                  }}
                                  className="absolute top-2 right-2 w-7 h-7 sm:w-6 sm:h-6 bg-red-500 text-white rounded-full text-sm font-bold hover:bg-red-600 transition flex items-center justify-center"
                                >
                                  √ó
                                </button>
                                <div className="flex items-start justify-between mb-3">
                                  <div className="font-semibold text-gray-900 flex-1">{script.name}</div>
                                  <div className="ml-2">
                                    <button
                                      onClick={(e) => {
                                        e.stopPropagation();
                                        updateScript(script.id, 'winning_ads', script.winning_ads === 1 ? 0 : 1);
                                      }}
                                      className={`px-3 py-1 rounded-full text-xs font-bold transition-all ${
                                        script.winning_ads === 1
                                          ? 'bg-emerald-500 text-white border-2 border-emerald-600'
                                          : 'bg-gray-200 text-gray-600 border-2 border-gray-300'
                                      }`}
                                    >
                                      {script.winning_ads === 1 ? '‚úì Winning' : '‚úó Not Winning'}
                                    </button>
                                  </div>
                                </div>

                                <div className="flex items-center gap-2 mb-3 flex-wrap">
                                  <select
                                    value={script.lane}
                                    onChange={(e) => updateScript(script.id, 'lane', e.target.value)}
                                    onClick={(e) => e.stopPropagation()}
                                    className={`px-3 py-1 rounded-full text-xs font-bold border-2 cursor-pointer ${
                                      script.lane === 'Problem‚ÜíSolution'
                                        ? 'bg-purple-100 text-purple-700 border-purple-400'
                                        : script.lane === 'Offer/Value'
                                        ? 'bg-blue-100 text-blue-700 border-blue-400'
                                        : 'bg-yellow-100 text-yellow-700 border-yellow-400'
                                    }`}
                                  >
                                    <option value="Problem‚ÜíSolution">Problem‚ÜíSolution</option>
                                    <option value="Offer/Value">Offer/Value</option>
                                    <option value="Educational">Educational</option>
                                  </select>
                                  
                                  {script.creator && (
                                    <span className="px-3 py-1 bg-[#214e65] text-white rounded-full text-xs font-bold border-2 border-[#214e65]">
                                      üë§ {script.creator}
                                    </span>
                                  )}
                                </div>

                                <div className="mb-3 p-3 bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg border-2 border-gray-200">
                                  <div className="grid grid-cols-2 gap-2 mb-2">
                                    <div>
                                      <label className="text-xs font-semibold text-gray-600 block mb-1">üìÖ Created</label>
                                      <input
                                        type="date"
                                        value={script.date_created || ''}
                                        onChange={(e) => updateScript(script.id, 'date_created', e.target.value)}
                                        onClick={(e) => e.stopPropagation()}
                                        className="text-xs border-2 border-gray-300 rounded-lg px-2 py-1.5 w-full font-medium focus:border-[#214e65] focus:outline-none"
                                      />
                                    </div>
                                    <div>
                                      <label className="text-xs font-semibold text-gray-600 block mb-1">üöÄ Launched</label>
                                      <input
                                        type="date"
                                        value={script.date_launched || ''}
                                        onChange={(e) => updateScript(script.id, 'date_launched', e.target.value)}
                                        onClick={(e) => e.stopPropagation()}
                                        className="text-xs border-2 border-gray-300 rounded-lg px-2 py-1.5 w-full font-medium focus:border-[#214e65] focus:outline-none"
                                      />
                                    </div>
                                  </div>
                                  {script.date_created && script.date_launched && (
                                    <div className="mt-2 px-2 py-1 bg-white rounded-md border border-gray-300">
                                      <span className="text-xs font-bold text-[#214e65]">
                                        ‚è± {Math.floor((new Date(script.date_launched) - new Date(script.date_created)) / (1000 * 60 * 60 * 24))} days to launch
                                      </span>
                                    </div>
                                  )}
                                </div>
                                
                                <div className="border-2 border-gray-300 rounded-lg overflow-hidden shadow-sm mb-3">
                                  {expandedScript === script.id ? (
                                    <textarea
                                      value={script.full_script}
                                      onChange={(e) => updateScript(script.id, 'full_script', e.target.value)}
                                      onClick={(e) => e.stopPropagation()}
                                      className="w-full p-3 text-sm text-gray-700 bg-white resize-none focus:outline-none"
                                      rows={12}
                                    />
                                  ) : (
                                    <div 
                                      className="p-3 text-sm text-gray-700 bg-white max-h-20 overflow-hidden"
                                    >
                                      {script.full_script}
                                    </div>
                                  )}
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      setExpandedScript(expandedScript === script.id ? null : script.id);
                                    }}
                                    className="w-full p-2 bg-[#214e65] text-white text-xs font-bold hover:opacity-90 transition-opacity border-t-2 border-[#214e65]"
                                  >
                                    {expandedScript === script.id ? 'Collapse Script' : 'Expand Script'}
                                  </button>
                                </div>

                                <select
                                  value={script.creator || ''}
                                  onChange={(e) => updateScript(script.id, 'creator', e.target.value || null)}
                                  onClick={(e) => e.stopPropagation()}
                                  className="w-full text-xs border-2 border-gray-300 rounded-lg px-3 py-2 font-medium focus:border-[#214e65] focus:outline-none"
                                >
                                  <option value="">üë§ Assign Creator...</option>
                                  {creators.map(c => (
                                    <option key={c.id} value={c.name}>{c.name}</option>
                                  ))}
                                </select>
                              </div>
                            ))}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'creators' && (
              <div className="space-y-6">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0">
                  <h2 className="text-xl sm:text-2xl font-semibold text-gray-900">Creator Pipeline</h2>
                  <button
                    onClick={addCreator}
                    className="px-4 sm:px-5 py-2 sm:py-2.5 bg-[#214e65] text-white rounded-lg font-medium hover:opacity-90 transition text-sm w-full sm:w-auto"
                  >
                    + New Creator
                  </button>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                  {sortedCreators.map(creator => (
                    <div 
                      key={creator.id} 
                      draggable
                      onDragStart={() => handleCreatorDragStart(creator)}
                      onDrop={() => handleCreatorDrop(creator)}
                      onDragOver={handleDragOver}
                      className="bg-white rounded-xl p-4 border-2 border-[#214e65] shadow-sm hover:shadow-xl hover:scale-105 transition-all duration-200 relative cursor-move"
                    >
                      <button
                        onClick={() => deleteCreator(creator.id)}
                        className="absolute top-3 right-3 w-6 h-6 bg-red-500 text-white rounded-full text-sm font-bold hover:bg-red-600 transition"
                      >
                        √ó
                      </button>
                      <div className="flex flex-col items-center mb-4">
                        <div className="relative group mb-3">
                          <div className="w-16 h-16 rounded-full border-4 border-[#214e65] overflow-hidden bg-gray-100 flex items-center justify-center">
                            {creator.image ? (
                              <img src={creator.image} alt={creator.name} className="w-full h-full object-cover" />
                            ) : (
                              <span className="text-2xl text-gray-400">{creator.name[0]}</span>
                            )}
                          </div>
                          <label className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity">
                            <span className="text-white text-xs">Upload</span>
                            <input
                              type="file"
                              accept="image/*"
                              onChange={(e) => handleImageUpload(creator.id, e)}
                              className="hidden"
                            />
                          </label>
                        </div>
                        <input
                          type="text"
                          value={creator.name}
                          onChange={(e) => updateCreator(creator.id, 'name', e.target.value)}
                          className="text-base font-semibold text-gray-900 text-center mb-1 bg-transparent border-b-2 border-transparent hover:border-gray-300 focus:border-[#214e65] focus:outline-none px-2 py-1 w-full"
                        />
                        <div className="text-xs text-gray-500">{creator.scripts_assigned} scripts</div>
                      </div>

                      <div className="mb-3">
                        <label className="text-xs text-gray-600 block mb-1 font-semibold">Status</label>
                        <select
                          value={creator.status}
                          onChange={(e) => updateCreator(creator.id, 'status', e.target.value)}
                          className={`w-full px-3 py-2 border-2 rounded-lg text-sm font-bold focus:outline-none transition ${
                            creator.status === 'Confirmed' 
                              ? 'bg-green-100 border-green-500 text-green-700' 
                              : creator.status === 'Shortlisted'
                              ? 'bg-yellow-100 border-yellow-500 text-yellow-700'
                              : 'bg-red-100 border-red-500 text-red-700'
                          }`}
                        >
                          <option value="Shortlisted">üìã Shortlisted</option>
                          <option value="Confirmed">‚úÖ Confirmed</option>
                          <option value="Declined">‚ùå Declined</option>
                        </select>
                      </div>

                      <div className="mb-3">
                        <label className="text-xs text-gray-600 block mb-1 font-semibold">Email</label>
                        <input
                          type="email"
                          value={creator.email}
                          onChange={(e) => updateCreator(creator.id, 'email', e.target.value)}
                          placeholder="creator@email.com"
                          className="w-full px-2 py-1.5 border-2 border-gray-300 rounded-lg text-xs focus:border-[#214e65] focus:outline-none"
                        />
                      </div>

                      <div className="mb-3">
                        <label className="text-xs text-gray-600 block mb-1 font-semibold">Portfolio</label>
                        <input
                          type="url"
                          value={creator.portfolio}
                          onChange={(e) => updateCreator(creator.id, 'portfolio', e.target.value)}
                          placeholder="https://portfolio.com"
                          className="w-full px-2 py-1.5 border-2 border-gray-300 rounded-lg text-xs focus:border-[#214e65] focus:outline-none"
                        />
                        {creator.portfolio && (
                          <a
                            href={creator.portfolio}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-xs text-[#214e65] hover:underline mt-1 inline-block"
                          >
                            ‚Üí Open
                          </a>
                        )}
                      </div>

                      <div className="bg-blue-50 rounded-lg p-3 mb-3 border-2 border-[#214e65]">
                        <div className="text-xs text-gray-600 mb-1">Rate Card</div>
                        <div className="flex items-baseline gap-1">
                          <span className="text-xs text-gray-500">¬£</span>
                          <input
                            type="number"
                            value={creator.rate}
                            onChange={(e) => updateCreator(creator.id, 'rate', parseInt(e.target.value) || 0)}
                            className="text-lg font-bold text-[#214e65] bg-transparent w-20 focus:outline-none"
                          />
                          <span className="text-xs text-gray-500">/ video</span>
                        </div>
                      </div>

                      <div className="bg-gray-50 rounded-lg p-3 mb-3 border-2 border-gray-200">
                        <div className="text-xs text-gray-600 mb-1 font-semibold">Actual Spend</div>
                        <div className="flex items-baseline gap-1">
                          <span className="text-xs text-gray-500">¬£</span>
                          <input
                            type="number"
                            value={creator.actual_spend || 0}
                            onChange={(e) => updateCreator(creator.id, 'actual_spend', parseInt(e.target.value) || 0)}
                            className="text-lg font-bold text-gray-900 bg-transparent w-20 focus:outline-none"
                          />
                        </div>
                      </div>

                      <div className="flex items-center justify-center gap-2 mb-3 p-2 bg-gray-50 rounded-lg border border-gray-200">
                        <div className="text-2xl font-bold text-[#214e65]">{creator.winning_ads}</div>
                        <div className="text-xs text-gray-600">winning ads</div>
                      </div>

                      <div className="mb-3 p-2 bg-gray-50 rounded-lg border border-gray-200">
                        <div className="text-xs text-gray-600 mb-1 text-center font-semibold">Rating</div>
                        <div className="flex items-center justify-center gap-1">
                          {[1, 2, 3, 4, 5].map(star => (
                            <button
                              key={star}
                              onClick={() => updateCreator(creator.id, 'rating', star)}
                              className="text-xl hover:scale-110 transition-transform"
                            >
                              {star <= (creator.rating || 0) ? '‚≠ê' : '‚òÜ'}
                            </button>
                          ))}
                        </div>
                      </div>

                      <div>
                        <div className="text-xs text-gray-500 mb-1">Notes</div>
                        <textarea
                          value={creator.notes}
                          onChange={(e) => updateCreator(creator.id, 'notes', e.target.value)}
                          placeholder="Add notes..."
                          className="w-full p-2 bg-gray-50 border-2 border-gray-200 rounded-lg text-xs text-gray-700 focus:border-[#214e65] focus:outline-none resize-none"
                          rows={2}
                        />
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<MarnaDashboard />);
  </script>
</body>
</html>
